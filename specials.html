<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TRODDR — Daily Specials</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="/images/troddr_logo.png">
  <link rel="icon" type="image/png" href="/images/troddr_logo.png">
  <link rel="apple-touch-icon" href="/images/troddr_logo.png">

  <style>
    /* --- REUSED STYLES (from your listing page) --- */
    :root{
      --brand:#0077cc; --bg:#ffffff; --fg:#0b1220; --muted:#6b7280; --card:#f8fafc; --line:#e5e7eb;
      --radius:14px; --gap:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg)}
    a{text-decoration:none;color:inherit}

    .wrap{max-width:1100px;margin:0 auto;padding:0 20px 20px}
    .header + .wrap{padding-top:0}

    header.page{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:6px 0 12px}
    .titleBlock{min-width:0}
    .title{
      font-size:clamp(28px,3.2vw,42px);
      font-weight:700;
      margin:16px 0 6px;
      letter-spacing:-0.01em;
      line-height:1.1;
    }
    .sub{color:var(--muted);font-size:16px}
    /* Note: Hero and Action/Info List styles removed as this is a list page. */
    
    /* --- NEW STYLES for Specials Grid --- */
    .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: var(--gap);
        margin-top: 20px;
    }

    .special-card {
        background: #fff; /* White background for contrast */
        border: 1px solid var(--line);
        border-radius: var(--radius);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        text-decoration: none;
        box-shadow: 0 4px 10px rgba(0,0,0,.05);
        transition: transform 0.1s ease-in-out, box-shadow 0.2s ease;
    }
    .special-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0,0,0,.1);
    }

    .special-card-img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        background: #e9ecef;
        display: block;
    }

    .special-card-body {
        padding: 14px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .special-card-title {
        font-weight: 700;
        font-size: 18px;
        margin: 0 0 4px 0;
        color: var(--fg);
        line-height: 1.2;
    }

    .special-card-meta {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 8px;
        font-weight: 500;
    }

    .special-card-desc {
        font-size: 14px;
        color: #333;
        margin-bottom: 12px;
        flex-grow: 1; /* Pushes the tag to the bottom */
        display: -webkit-box;
        /* -webkit-line-clamp: 3; */
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .special-tag {
        align-self: flex-start;
        background: #e6f1fb;
        color: var(--brand);
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        margin-top: 8px;
    }
    .skeleton{background:linear-gradient(90deg,#f2f4f7,#e9edf2,#f2f4f7);background-size:200% 100%;animation:shimmer 1.2s infinite;color:transparent !important}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .skel-line{height:14px;border-radius:7px;margin:8px 0}
  </style>

  <script>
    // Expose env (same pattern as itinerary page)
    window.env = window.env || {
      SUPABASE_URL: 'https://rprpwudhplodaqmmwqkf.supabase.co',
      SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwcnB3dWRocGxvZGFxbW13cWtmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyODcyODksImV4cCI6MjA2NTg2MzI4OX0.lNL6YZQqZgbsQRJyRAXpaWMC4LxncvPPyXNP1qopTFk'
    };
  </script>
</head>
<body>
  <header class="header" role="banner">
    <div class="navbar">
      <a href="/" class="logo" aria-label="TRODDR - Home">troddr</a>
      <button class="mobile-menu-btn" aria-controls="primary-navigation" aria-expanded="false" aria-label="Open menu">
        <span aria-hidden="true">☰</span>
      </button>
      <div class="nav-links" id="primary-navigation" role="navigation">
        <button class="nav-close-btn" aria-controls="primary-navigation" aria-label="Close menu">×</button>
        <a href="/about.html" class="nav-item">About</a>
        <a href="/#features" class="nav-item">Features</a>
        <a href="/contact.html" class="nav-item">Contact</a>
        <a href="/#waitlist" class="nav-cta">Join Waitlist</a>
      </div>
    </div>
  </header>
  <div class="wrap">
    
    <header class="page">
      <div class="titleBlock">
        <h1 class="title">✨ Daily Specials</h1>
        <div class="sub">Curated deals and limited-time offers from local businesses.</div>
      </div>
    </header>

    <section class="grid-container" id="specials-grid">
      </section>
    
    <div id="loading" style="text-align:center; padding: 40px; display:none;">
      <p>Loading specials...</p>
    </div>
    <div id="no-results" style="text-align:center; padding: 40px; display:none;">
      <p>No specials available right now. Check back soon!</p>
    </div>

  </div>

  <footer class="footer">
    <div class="section-container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>TRODDR</h3>
                <p>Your ultimate Jamaican travel companion. Discover authentic experiences, plan perfect trips, and explore the island like a local.</p>
            </div>
            <div class="footer-section">
                <h3>Company</h3>
                <div class="footer-links">
                    <a href="about.html">About Us</a>
                    <a href="#features">Features</a>
                    <a href="contact.html">Contact</a>
                    <a href="#demo">Join Waitlist</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Discover</h3>
                <div class="footer-links">
                    <a href="#">Eat</a>
                    <a href="#">Stay</a>
                    <a href="#">Play</a>
                    <a href="#">Destinations</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Plan</h3>
                <div class="footer-links">
                    <a href="#">Trip Planner</a>
                    <a href="#">Itineraries</a>
                    <a href="#">Travel Guides</a>
                    <a href="#">Local Tips</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Support</h3>
                <div class="footer-links">
                    <a href="#">Help Center</a>
                    <a href="contact.html">Contact Us</a>
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms of Service</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                <div class="footer-links">
                    <a href="mailto:hello@troddr.com">hello@troddr.com</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 TRODDR. Made with ❤️ in Jamaica. Explore authentic experiences across the Caribbean.</p>
        </div>
    </div>
</footer>
  <script>
    (function(){
      const menuBtn  = document.querySelector('.mobile-menu-btn');
      const navLinks = document.querySelector('.nav-links');
      const closeBtn = document.querySelector('.nav-close-btn');
  
      if (!menuBtn || !navLinks) return;
  
      menuBtn.addEventListener('click', function(){
        const isOpen = navLinks.classList.toggle('mobile-open');
        this.classList.toggle('active', isOpen);
        this.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
        document.body.classList.toggle('menu-open', isOpen);
      });
  
      navLinks.addEventListener('click', function(e){
        const link = e.target.closest('a');
        if (!link) return;
        navLinks.classList.remove('mobile-open');
        menuBtn.classList.remove('active');
        menuBtn.setAttribute('aria-expanded', 'false');
        document.body.classList.remove('menu-open');
      });
  
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          navLinks.classList.remove('mobile-open');
          menuBtn.classList.remove('active');
          menuBtn.setAttribute('aria-expanded', 'false');
          document.body.classList.remove('menu-open');
        });
      }
  
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape') {
          navLinks.classList.remove('mobile-open');
          menuBtn.classList.remove('active');
          menuBtn.setAttribute('aria-expanded', 'false');
          document.body.classList.remove('menu-open');
        }
      });
    })();
    // ... waitlist handler (omitted for brevity)
  </script>
  
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    const SUPABASE_URL = (window.env?.SUPABASE_URL || '').trim();
    const SUPABASE_ANON_KEY = (window.env?.SUPABASE_ANON_KEY || '').trim();
    const supa = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth: { persistSession: false } });

    const $ = (sel) => document.querySelector(sel);
    const setDisplay = (id, visible) => { const el = document.getElementById(id); if (el) el.style.display = visible ? '' : 'none'; };

    /**
     * Renders a single special as an HTML card.
     */
    function renderSpecialCard(special) {
        const slug = special.specials_slug || special.slug;
        const title = special.name || 'Untitled Special';
        // Note: The card links to the existing detailed listing page
        const link = `/listings/${encodeURIComponent(slug)}`;
        // Use the first image or a default fallback
        const images = special.image ? (Array.isArray(special.image) ? special.image : JSON.parse(special.image || '[]')) : [];
        const image = images.length ? images[0] : 'https://images.unsplash.com/photo-1549488344-ec298e3b1236?w=400&q=80&auto=format&fit=crop'; // Placeholder URL

        const tag = special.special_type || special.category;
        const meta = [special.town, special.parish].filter(Boolean).join(', ');

        return `
            <a class="special-card" href="${link}">
                <img src="${image}" alt="${title}" class="special-card-img">
                <div class="special-card-body">
                    <div class="special-card-meta">${meta || 'Jamaica'}</div>
                    <h2 class="special-card-title">${title}</h2>
                    <p class="special-card-desc">${special.description || special.short_description || 'Check out this limited-time offer from TRODDR!'}</p>
                    ${tag ? `<span class="special-tag">${tag}</span>` : ''}
                </div>
            </a>
        `;
    }

    /**
     * Generates skeleton loading cards.
     */
    function renderSkeletons(count = 6) {
        const skeletons = Array(count).fill(0).map(() => `
            <div class="special-card skeleton">
                <div class="special-card-img skeleton"></div>
                <div class="special-card-body">
                    <div class="skel-line" style="width:50%; margin-bottom:8px;"></div>
                    <div class="skel-line" style="width:80%; height:20px; margin-bottom:10px;"></div>
                    <div class="skel-line" style="width:95%;"></div>
                    <div class="skel-line" style="width:70%;"></div>
                </div>
            </div>
        `).join('');
        document.getElementById('specials-grid').innerHTML = skeletons;
    }

    /**
     * Fetches and renders all current specials.
     */
    async function fetchAndRenderSpecials() {
        const grid = document.getElementById('specials-grid');
        if (!grid) return;

        // 1. Show loading state
        renderSkeletons();
        setDisplay('loading', false);
        setDisplay('no-results', false);

        try {
            // Assume the 'places' table has a flag or filterable field for specials
            const { data: specials, error } = await supa
                .from('places')
                .select('name, specials_slug, slug, town, parish, description, short_description, image, special_type, category')
                .eq('is_special', true) // Filter by a specials flag
                .limit(50); 

            if (error || !specials || specials.length === 0) {
                grid.innerHTML = ''; // Clear skeletons
                setDisplay('no-results', true);
                return;
            }

            // 2. Render cards
            const cardsHtml = specials.map(renderSpecialCard).join('');
            grid.innerHTML = cardsHtml;

        } catch (e) {
            grid.innerHTML = '<p style="color:red; text-align:center; padding:40px;">An error occurred while fetching specials. Please try again.</p>';
            console.error("Specials fetch error:", e);
        }
    }

    // Execute on page load
    fetchAndRenderSpecials();
  </script>
</body>
</html>